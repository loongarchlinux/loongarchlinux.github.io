+++
title = "Package Info"
author = ""
date = 2023-06-14T21:21:37+08:00
draft = false
type = "package"
+++

<div id="pkgdetails" class="box">
    <h2 id="h2_namever" class="error">连接远程服务器失败！</h2>
    <div id="detailslinks" class="listing">
        <div id="actionlist">
        <h4>Package Actions</h4>
            <ul class="small">
                <li>
                    <a id="a_git_src" href="https://gitlab.archlinux.org/archlinux/packaging/packages/" target="_blank" title="View source files for">Source Files</a> /
                    <a id="a_git_log" href="https://gitlab.archlinux.org/archlinux/packaging/packages/" target="_blank" title="View changes for ">View Changes</a>
                </li>
                <li><a id="a_download" href="download/" rel="nofollow" title="Download from mirror">Download From Mirror</a></li>
            </ul>
        </div>
    </div>

    <table id="pkginfo">
        <tr>
            <th>Architecture:</th>
            <td><a id="a_arch" href="/packages/?arch=loong64"
                    title="Browse packages for loong64 architecture">loong64</a></td>
        </tr><tr>
            <th>Repository:</th>
            <td><a id="a_repo" href="/packages/?repo=core"
                    title="Browse the Core repository">Core</a></td>
        </tr>

        <tr>
            <th>Description:</th>
            <td class="wrap" itemprop="description" id="description">Package Description</td>
        </tr><tr>
            <th>Upstream URL:</th>
            <td><a itemprop="url" id="a_url" href="https://loongarch.dev/"
                    title="Visit the website for package">package</a></td>
        </tr><tr>
            <th>License(s):</th>
            <td class="wrap" id="td_license">CCPL, GPL2</td>
        </tr>
				<tr>
            <th>Package Size:</th>
            <td id="td_size">14.1 MB</td>
        </tr><tr>
            <th>Installed Size:</th>
            <td id="td_isize">47.1 MB</td>
        </tr><tr>
            <th>Last Packager:</th>
            <td>
            <a id="a_packager" href="/packages/?packager=svenstaro"
                title="View packages packaged by Sven-Hendrik Haase">Sven-Hendrik Haase</a>
            </td>
        </tr><tr>
            <th>Build Date:</th>
            <td id="td_build_date">2023-05-11 03:37 UTC</td>
        </tr>
    </table>

    <div id="metadata">
			<div id="pkgdeps" class="listing">
				<h3 id="h3_deps_count" title="has the following dependencies">
					Dependencies (0)</h3>
				<ul id="pkgdepslist">
				</ul>
			</div>

			<div id="pkgreqs" class="listing">
				<h3 title="Packages that requires">
					Required By (x)</h3>
				<ul id="pkgreqslist">
					<li>No data here.</li>

				</ul>
			</div>

			<div id="pkgfiles" class="listing">
				<h3 title="Complete list of files contained within this package">
					Package Contents</h3>
				<div id="pkgfilelist">
					<p><a id="filelink"
								href="https://archapi.zhcn.cc/api/v1/package/files/"
								title="Click to view the complete file list for package">
						View the file list for package</a></p>
				</div>
			</div>
		</div>
</div>

<script type="text/javascript">
	function ajaxifyFiles() {
		filelink.addEventListener("click", function(event) {
			event.preventDefault();
			console.log(event.target.href);
			fetch(event.target.href).then(response => response.json()).then(data => {
				const fragment = document.createDocumentFragment();
				data.files.forEach((value, i) => {
					const cls = value.match(/\/$/) ? 'd' : 'f';
					const elem = document.createElement('li');
					elem.classList.add(cls);
					elem.textContent = value
					fragment.appendChild(elem);
				});

				const pkgfilelist = document.getElementById("pkgfilelist");
				while(pkgfilelist.firstChild) {
					pkgfilelist.removeChild(pkgfilelist.firstChild);
				}

				const textElem = document.createElement("p");
				textElem.classList.add("message");

				if (data.pkg_last_update > data.files_last_update) {
					textElem.textContent = "Note: This file list was generated from a previous version of the package; it may be out of date.";
					pkgfilelist.appendChild(textElem);
				}

				if (data.files.length > 0) {
					const elem = document.createElement("ul");
					elem.appendChild(fragment);
					pkgfilelist.appendChild(elem);
				} else if (data.files_last_update === null) {
					textElem.textContent = "No file list available.";
					pkgfilelist.appendChild(textElem);
				} else {
					textElem.textContent = "Package has no files.";
					pkgfilelist.appendChild(textElem);
				}
			});
		});
	}

	function collapseDependsList(list) {
		// Hide everything past a given limit. Don't do anything if we don't have
		// enough items, or the link already exists.
		const limit = 20;
		const elem = document.querySelector(list);
		const linkid = elem.getAttribute('id') + 'link';
		const items = Array.from(elem.querySelectorAll('li')).slice(limit);

		if (items.length <= 1 || document.querySelectorAll('#' + linkid).length > 0) {
			return;
		}

		items.forEach(item => item.style.display = 'none');

		const link = document.createElement("A");
		link.setAttribute('href', '#');
		link.id = linkid;
		link.textContent = "Show More…";
		const p = document.createElement("p");
		p.appendChild(link);
		elem.insertAdjacentElement('afterend', p);

		// add link and wire it up to show the hidden items
		document.getElementById(linkid).addEventListener('click', function(event) {
			event.preventDefault();
			Array.from(elem.querySelectorAll('li')).forEach(item => item.style.display = '');
			// remove the full <p/> node from the DOM
			event.target.parentElement.removeChild(event.target);
		});
	}

	function getfilesize(size) {
		if (!size)
			return "";

		var num = 1024.00;

		if (size < num)
			return size + "B";
		if (size < Math.pow(num, 2))
			return (size / num).toFixed(2) + "K";
		if (size < Math.pow(num, 3))
			return (size / Math.pow(num, 2)).toFixed(2) + "M";
		if (size < Math.pow(num, 4))
			return (size / Math.pow(num, 3)).toFixed(2) + "G";
		return (size / Math.pow(num, 4)).toFixed(2) + "T";
	}

	function showpackager(result) {
		let packager_array = result.packager.split('<');
		let user = packager_array[0].replace(/(\s*$)/g,"");
		let email = packager_array[1].replace(">", "").replace(/(\s*$)/g,"");
		$('#a_packager').html(user).attr("href", "mailto:"+email).attr("title", "Send email to " + user);
	}

	function showdeps(result) {
		var deps_count = result.depends.length + result.optdepends.length + result.makedepends.length + result.checkdepends.length;
		$('#h3_deps_count').text("Dependencies (" + deps_count + ")");
		for(var i=0;i< result.depends.length;i++){
			$li = $("<li><a href=\"/packages/?q=" + result.depends[i] +"\">" + result.depends[i] + "</a></li>");
			$("#pkgdepslist").append($li);
		}
		for(var i=0;i< result.optdepends.length;i++){
			$li = $("<li><a href=\"/packages/?q=" + result.optdepends[i] +"\">" + result.optdepends[i] + "</a> (optional)</li>");
			$("#pkgdepslist").append($li);
		}
		for(var i=0;i< result.makedepends.length;i++){
			$li = $("<li><a href=\"/packages/?q=" + result.makedepends[i] +"\">" + result.makedepends[i] + "</a> (make)</li>");
			$("#pkgdepslist").append($li);
		}
		for(var i=0;i< result.checkdepends.length;i++){
			$li = $("<li><a href=\"/packages/?q=" + result.checkdepends[i] +"\">" + result.checkdepends[i] + "</a> (check)</li>");
			$("#pkgdepslist").append($li);
		}
		collapseDependsList("#pkgdepslist");
	}
</script>

<script>
	$(document).ready(function() {
		var baseurl = "https://archapi.zhcn.cc/api/v1"
		var url = baseurl + "/package/" + $(location).attr('search');
		$.ajax({
			url: url,
			dataType: "json",
			success:function(result) {
				$('#text').html(result.pkgname);
				$('#h2_namever').html(result.pkgname + " " + result.pkgver).removeAttr('class');
				$('#a_git_src').attr("href", "https://github.com/loongarchlinux/"+result.repo.replace("-testing", "")+"/tree/main/" + result.pkgbase).attr("title", "View source files for " + result.pkgname);
				$('#a_git_log').attr("href", "https://github.com/loongarchlinux/"+result.repo.replace("-testing", "")+"/commits/main/" + result.pkgbase).attr("title", "View changes for " + result.pkgname);
				$('#a_download').attr("href", baseurl + "/" + result.repo + "/" + result.arch + "/" + result.pkgname + "/download/").attr("title", "Download " + result.pkgname + "from mirror");
				$('#a_arch').html(result.arch).attr("href", "/packages/?arch="+result.arch).attr("title", "Browse packages for " + result.arch + " architecture");
				$('#a_repo').html(result.repo).attr("href", "/packages/?repo="+result.repo).attr("title", "Browse the " + result.repo + "repository");
				$('#description').html(result.pkgdesc);
				$('#a_url').html(result.url).attr("href", result.url).attr("title", "Visit the website for "+result.pkgname);
				$('#td_license').html(result.licenses.join(","));
				$('#td_size').html(getfilesize(result.compressed_size));
				$('#td_isize').html(getfilesize(result.installed_size));
				$('#td_build_date').html(result.build_date);
				$('#filelink').attr("href", baseurl + "/package/files/" + $(location).attr('search')).attr("title", "Click to view the complete file list for " + result.pkgname);
				ajaxifyFiles();
				showpackager(result);
				showdeps(result);
			}
		});
	});
</script>
